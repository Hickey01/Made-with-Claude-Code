# ============================================================================
# CHG HEALTHCARE MCP SERVER CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in your actual CHG Healthcare values
# This is for ENTERPRISE DEPLOYMENT with user-level Okta SSO authentication

# ============================================================================
# OKTA SSO CONFIGURATION (CHG Healthcare)
# ============================================================================
# This configuration allows individual CHG employees to authenticate with
# their own Okta credentials (not a shared service account)

# Okta Authorization Server Issuer URL
# CHG Healthcare Okta domain
OKTA_ISSUER=https://chghealthcare.okta.com/oauth2/default

# Okta API Audience
# This identifies your MCP server as a protected resource
# Coordinate with CHG IT to set this value
OKTA_AUDIENCE=api://mcp-server
# Alternative: OKTA_AUDIENCE=https://mcp.chghealthcare.com

# Okta Application Client ID
# Create a "Web Application" or "Native Application" in Okta (NOT Service app)
# This allows user-level authentication with Authorization Code flow
# Find in: Okta Admin → Applications → Your MCP Application → General
OKTA_CLIENT_ID=your_web_app_client_id_here

# ============================================================================
# IMPORTANT: Authentication Flow Selection
# ============================================================================
#
# FOR PRODUCTION (Individual User Authentication):
#   - Use Web Application or Native Application in Okta
#   - Grant type: Authorization Code + PKCE
#   - Each user authenticates with their CHG credentials
#   - User's Okta groups determine their access level
#   - Audit logs show individual user activity
#   - DO NOT SET OKTA_CLIENT_SECRET (not needed for auth code flow)
#
# FOR DEVELOPMENT/TESTING ONLY (Service Account):
#   - Use Machine-to-Machine application in Okta
#   - Grant type: Client Credentials
#   - Shared service account (not recommended for production)
#   - Set OKTA_CLIENT_SECRET below
#
# OKTA_CLIENT_SECRET=your_client_secret_here  # Only for dev/testing!

# ============================================================================

# DBT CLOUD CONFIGURATION (CHG Healthcare)
# ============================================================================
# dbt Cloud API Configuration
# Documentation: https://docs.getdbt.com/dbt-cloud/api-v2

# dbt Cloud API URL (default is cloud.getdbt.com)
DBT_CLOUD_API_URL=https://cloud.getdbt.com/api/v2

# dbt Cloud Account ID
# Find in: dbt Cloud → Account Settings → Account ID
DBT_CLOUD_ACCOUNT_ID=your_account_id_here

# Service Account Authentication (Recommended for MCP Server)
# The MCP server connects to dbt Cloud using a service account token
# Individual user access is still controlled by Okta RBAC
# Only users with mcp_analyst or mcp_admin roles can access dbt Cloud tools

# Option 1: Service Account Token (Recommended)
# Create in dbt Cloud: Account Settings → Service Tokens
# Requires permissions: Read-only or Job Admin depending on needs
DBT_CLOUD_SERVICE_TOKEN=your_service_token_here

# Option 2: OAuth 2.0 (Advanced - for user-level authentication)
# Enable if you want to use user-specific OAuth tokens instead of service account
# This requires setting up an OAuth application in dbt Cloud
# DBT_CLOUD_OAUTH_CLIENT_ID=your_oauth_client_id
# DBT_CLOUD_OAUTH_CLIENT_SECRET=your_oauth_client_secret

# NOTE: dbt Cloud authentication is separate from Okta user authentication
# - Okta controls WHO can access dbt Cloud tools (mcp_analyst role required)
# - dbt Cloud credentials control WHAT data/jobs the server can access
# - Audit logs track which Okta user requested dbt Cloud operations

# ============================================================================

# SNOWFLAKE CONFIGURATION (Integrated into Combined Server)
# ============================================================================
# Snowflake is integrated directly into this MCP server
# The server connects to Snowflake using the Snowflake Python Connector

# Snowflake Account Information
SNOWFLAKE_ACCOUNT=chghealthcare
SNOWFLAKE_WAREHOUSE=ANALYTICS_WH
SNOWFLAKE_DATABASE=HEALTHCARE_DATA
SNOWFLAKE_SCHEMA=PUBLIC
SNOWFLAKE_ROLE=ANALYST_ROLE

# Authentication Options:

# Option 1: Okta SSO (Recommended for CHG Healthcare)
# Uses external browser for Okta authentication
SNOWFLAKE_AUTHENTICATOR=externalbrowser
SNOWFLAKE_USER=your.email@chghealthcare.com

# Option 2: Key Pair Authentication (Service Accounts)
# Generate keys: openssl genrsa 2048 | openssl pkcs8 -topk8 -inform PEM -out rsa_key.p8 -nocrypt
# Then upload public key to Snowflake user
# SNOWFLAKE_USER=svc_mcp_server
# SNOWFLAKE_PRIVATE_KEY_PATH=/path/to/rsa_key.p8

# Option 3: Username/Password (Development Only - Not Recommended)
# SNOWFLAKE_USER=your_username
# SNOWFLAKE_PASSWORD=your_password

# Option 4: Okta OAuth Token Passthrough (RECOMMENDED for Production)
# This passes the user's Okta token directly to Snowflake
# Requires Snowflake External OAuth integration with Okta
# See SNOWFLAKE_OKTA_OAUTH_SETUP.md for configuration steps
#
# To enable:
# 1. Configure Snowflake External OAuth (see documentation)
# 2. Set SNOWFLAKE_OAUTH_ENABLED=true
# 3. No SNOWFLAKE_USER or password needed - identity comes from Okta token
#
# SNOWFLAKE_OAUTH_ENABLED=true
# SNOWFLAKE_ACCOUNT=chghealthcare
# SNOWFLAKE_WAREHOUSE=ANALYTICS_WH
# SNOWFLAKE_DATABASE=HEALTHCARE_DATA
# SNOWFLAKE_SCHEMA=PUBLIC
# SNOWFLAKE_ROLE=ANALYST_ROLE  # Optional - can be mapped from Okta groups

# NOTE: Snowflake integration is built into this combined server
# - Snowflake RBAC controls data access (role, grants, policies)
# - Okta controls WHO can access Snowflake tools (mcp_analyst role required)
# - Audit logs track which Okta user executed Snowflake queries

# ============================================================================

# Server Configuration
MCP_SERVER_HOST=0.0.0.0
MCP_SERVER_PORT=8000

# Logging Level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO
